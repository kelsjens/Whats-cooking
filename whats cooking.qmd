---
title: "Whats Cooking"
format: pdf
editor: visual
---

# Load libraries

```{r}
library(tidyverse)
library(tidymodels)
library(vroom)
library(dplyr)
library(tune)
library(ggplot2)
library(embed)
library(doParallel)
library(kknn)
library(discrim)
library(remotes)
library(jsonlite)
```

# Read Data

```{r}
trainSet <- read_file("C:/Users/User/OneDrive - Brigham Young University/Fall 2025/STAT 348/whats-cooking/train.json/train.json") %>% 
  fromJSON()
testSet <- read_file("C:/Users/User/OneDrive - Brigham Young University/Fall 2025/STAT 348/whats-cooking/test.json/test.json") %>%
  fromJSON()
```

# Recipe

```{r}
library(textrecipes)
recipe <- recipe(cuisine ~ ingredients, data = trainSet) %>% 
  # convert list-column to tokenlist
  step_mutate(ingredients = tokenlist(ingredients)) %>%
  # keep at most 500 most frequent ingredients
  step_tokenfilter(ingredients, max_tokens = 500) %>%
  # create TF-IDF features
  step_tfidf(ingredients)
```

# simple model

```{r}


# 2. Model spec (multinomial regression for classification)
cuisine_model <- multinom_reg(mode = "classification") %>% 
  set_engine("nnet", MaxNWts = 100000, trace = FALSE)

# 3. Workflow
wf <- workflow() %>% 
  add_model(cuisine_model) %>% 
  add_recipe(recipe)

# 4. Fit on trainSet
wf_fit <- wf %>% 
  fit(data = trainSet)

# 5. Predict classes for testSet
test_pred_class <- predict(wf_fit, new_data = testSet, type = "class")

# 6. Kaggle submission: id + predicted cuisine
submission <- testSet %>% 
  select(id) %>% 
  mutate(cuisine = test_pred_class$.pred_class)

write_csv(submission, "submission.csv")

```

# Random forest

```{r}
rf_spec <- rand_forest(
  mtry  = 10,     # you can tune this later
  trees = 150,
  min_n = 5
) %>% 
  set_mode("classification") %>% 
  set_engine("ranger", importance = "impurity")

wf <- workflow() %>% 
  add_recipe(recipe) %>% 
  add_model(rf_spec)

rf_fit <- wf %>% 
  fit(data = trainSet)

# predicted cuisine labels
test_pred_class <- predict(rf_fit, new_data = testSet, type = "class")

submission <- testSet %>% 
  select(id) %>% 
  mutate(cuisine = test_pred_class$.pred_class)

write_csv(submission, "submission_rf_tfidf.csv")

```

in tuning grid add argument control(save pred = true, verbosen
